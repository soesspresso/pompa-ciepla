<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja Pomiarowa</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
</head>
<body>
    <header>
        <h1>Aplikacja Pomiarowa</h1>
        <div id="authButtons"></div>
    </header>
    <main>
        <div id="dashboard"></div>
        <div id="formPage"></div>
        <div id="historyPage"></div>
        <div id="analyticsPage"></div>
    </main>

    <script>
        // Fade in the page
        document.body.style.opacity = 0;
        window.onload = function() {
            document.body.style.opacity = 1;
        };

        // Initialize Supabase client
        (async () => {
            const { createClient } = window.supabase;
            const supabaseUrl = 'YOUR_SUPABASE_URL';
            const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
            const supabase = createClient(supabaseUrl, supabaseKey);

            // UI Handling
            setupAuthButtons();
            await loadDashboard();
            setupFormPage();
            setupHistoryPage();
            setupAnalyticsPage();
        })();

        async function loadDashboard() {
            // Fetch and display the last reading from Supabase
            const { data, error } = await supabase
                .from('readings')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(1);

            if (error) {
                console.error("Error loading dashboard data:", error);
                return;
            }

            const lastReading = data[0];
            document.getElementById('dashboard').innerHTML = `<h2>Ostatni Odczyt</h2><p>${lastReading.kWh} kWh</p><p>Zużycie: ${lastReading.consumption}</p><p>Uruchomienia Sprężarki: ${lastReading.compressor_starts}</p><p>Średnia Dzienna: ${calculateDailyAverage(lastReading)}</p>`;
        }

        function calculateDailyAverage(reading) {
            // Calculation logic here
            return reading.kWh / 30; // Placeholder
        }

        function setupFormPage() {
            // Form and calculations handling
        }

        function setupHistoryPage() {
            // Display reading history with delete buttons
        }

        function setupAnalyticsPage() {
            // Display yearly stats and records
        }

        function setupAuthButtons() {
            // Google OAuth authentication handling
        }
    </script>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: Arial, sans-serif;
        }
        header {
            background-color: #1E1E1E;
            padding: 10px;
            text-align: center;
        }
        h1 {
            color: cyan;
        }
        #authButtons button {
            margin: 5px;
        }
        main { padding: 20px; }
    </style>
</body>
</html>